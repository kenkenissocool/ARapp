<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>marker-based Sample</title>
        <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
        <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
        <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
        <script>
            let timer;
            let lastPos;
        
            AFRAME.registerComponent('marker', {
              init: function () {
                const marker = this.el;
                const text = document.querySelector('a-text');
            
                marker.addEventListener('markerFound', function () {
                  clearInterval(timer);
                  timer = setInterval(() => {
                    const pos = marker.getAttribute('position');
                
                    if (lastPos) {
                      const diffX = pos.x - lastPos.x;
                      const diffY = pos.y - lastPos.y;
                      const diffZ = pos.z - lastPos.z;
                    
                      const diff = Math.sqrt(Math.pow(diffX * 10, 2) + Math.pow(diffY * 10, 2) + Math.pow(diffZ * 10, 2));
                    
                      if (diff > .1) {
                        text.setAttribute('color', 'blue');
                        text.setAttribute('value', 'MOVE');
                      } else {
                        text.setAttribute('color', 'red');
                        text.setAttribute('value', 'STOP');
                      }
                    }
                
                    lastPos = Object.assign({}, pos);
                  }, 100);
                });
            
                marker.addEventListener('markerLost', function () {
                
                });
              }
            });
        </script>
    </head>

    <body style="margin: 0; overflow: hidden;">
        <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false" renderer="logarithmicDepthBuffer: true;" vr-mode-ui="enabled: false" physics="debug: true">
            <a-marker preset="hiro">
              <a-box width="1" depth="1" height="1" wireframe="true" position=".1 0 -.45"></a-box>
              <a-text align="center" position="0 1 0" value="STOP"></a-text>
            </a-marker>
            <a-entity camera></a-entity>
            <a-camera gps-camera="gpsMinDistance:200; simulateAltitude: 250" rotation-reader></a-camera>
        </a-scene>
    </body>
</html>