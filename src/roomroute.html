<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
        <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
        <title>教室選択</title>
    </head>

    <body onload="routeAPI1()">
        <a-scene embedded arjs>
            <a-entity camera></a-entity>
        </a-scene>
    

        <script>
            async function touchAPI1(){
                let guides = [];
                const room = location.search.substring(1);
                //document.getElementById("resp").innerHTML = room;
                const urltemp = "https://g965edebf922493-cojt1.adb.ap-osaka-1.oraclecloudapps.com/ords/admin/tslo/4/";
                const url = urltemp + room;

                const routeAPI = async(urlz) =>{
                        const response = await fetch(urlz,{method : "get"});
                        const json = response.json();
                        if (response.status == 200){
                            return Promise.resolve(json);
                        }else{
                            return Promise.reject(json.error);
                        }
                }

                routeAPI(url)
                    .then(async function(data){
                        const items = data.items[0];
                        console.log(items);
                        Object.keys(items).forEach(function(key) {
                            var val = this[key]; // this は items
                            console.log([key], [val]);
                            sessionStorage.setItem([key],[val]);
                        }, items);
                        console.log(sessionStorage.getItem([1]));
                    })
                    .then(function(){
                        for (let i = 0; i < 13; i++) {
                            var ariadne ="";
                            console.log(i);
                            var point = sessionStorage.getItem([i]);
                            console.log(point);

                            if (point==0) {
                                ariadne="go back";
                            } else if (point==1) {
                                ariadne="arrived";
                            } else if (point==2) {
                                ariadne="turn right";
                            } else if (point==3) {
                                ariadne="go straight";
                            } else if (point==4) {
                                ariadne="turn left";
                            } else if (point==5) {
                                ariadne="go up";
                            } else if (point==6) {
                                ariadne="go down";
                            }
                            console.log(ariadne);
                        
                            let scene = document.querySelector("a-scene");
                        
                            let marker = document.createElement("a-marker");
                            marker.setAttribute("type", `pattern`);
                            marker.setAttribute("url", `./data/ARmarker/pattern-`+i+`.patt`);
                        
                            let text = document.createElement("a-text");
                            text.setAttribute("value", `${ariadne}`);
                            text.setAttribute("look-at", "[gps-camera]");
                            text.setAttribute("position", "0 .5 0");
                            text.setAttribute("rotation", "-90 0 0");
                            text.setAttribute("align", "center");
                        
                            marker.appendChild(text);
                            scene.appendChild(marker);
                        }
                        //window.location.href='https://kenkenissocool.github.io/ARapp/src/markers.html';
                        //window.location.href='./markers.html';
                    })
            }
            // for (let i = 0; i < 13; i++) {
            //     var ariadne ="";
            //     console.log(i);
            //     var point = sessionStorage.getItem([i]);
            //     console.log(point);

            //     if (point==0) {
            //         ariadne="go back";
            //     } else if (point==1) {
            //         ariadne="arrived";
            //     } else if (point==2) {
            //         ariadne="turn right";
            //     } else if (point==3) {
            //         ariadne="go straight";
            //     } else if (point==4) {
            //         ariadne="turn left";
            //     } else if (point==5) {
            //         ariadne="go up";
            //     } else if (point==6) {
            //         ariadne="go down";
            //     }
            //     console.log(ariadne);
            
            //     let scene = document.querySelector("a-scene");
            
            //     let marker = document.createElement("a-marker");
            //     marker.setAttribute("type", `pattern`);
            //     marker.setAttribute("url", `./data/ARmarker/pattern-`+i+`.patt`);
            
            //     let text = document.createElement("a-text");
            //     text.setAttribute("value", `${ariadne}`);
            //     text.setAttribute("look-at", "[gps-camera]");
            //     text.setAttribute("position", "0 .5 0");
            //     text.setAttribute("rotation", "-90 0 0");
            //     text.setAttribute("align", "center");
            
            //     marker.appendChild(text);
            //     scene.appendChild(marker);
            // }
        </script>
    </body>

</html>