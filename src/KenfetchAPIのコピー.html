
<script type="text/javascript">
    var crd = 0;

        function callAPIOCI(url){
            let lat;
            let lon;
            let currentlat = crd.latitude;
            let currentlon = crd.longitude;

            const locationAPI = async(urlz) =>{
                const response = await fetch(urlz,{method : "get"});
                const json = response.json();
                if (response.status == 200){
                    return Promise.resolve(json);
                }else{
                    return Promise.reject(json.error);
                }
            }

            locationAPI(url)
                .then(function(data){
                    return new Promise(function (resolve,reject){
                    const jsonObj = JSON.stringify(data);
                    const items = data.items;
                    lat = items[0]["lat"];
                    lon = items[0]["lon"];
                    const location = lon +", " + lat;
                    console.log(lat);
                    console.log(jsonObj);
                    document.getElementById("resp").textContent = location ;
                    resolve(location);});
                })
                .then(function(value){
                    let request = new XMLHttpRequest();

                        request.open('POST', "https://api.openrouteservice.org/v2/directions/foot-walking/geojson");

                        request.setRequestHeader('Accept', 'application/json, application/geo+json, application/gpx+xml, img/png; charset=utf-8');
                        request.setRequestHeader('Content-Type', 'application/json');
                        request.setRequestHeader('Authorization', '5b3ce3597851110001cf6248a9c8937ac7a74664b0dc317c69d6c058');

                        request.onreadystatechange = function () {
                        if (this.readyState === 4) {
                            console.log('Status:', this.status);
                            console.log('Headers:', this.getAllResponseHeaders());
                            console.log('Body:', this.responseText);
                        }
                        };
                        console.log(value);

                        const body = '{"coordinates":[['+ crd.longitude +', '+ crd.latitude +'],['+ value + ']]}';

                        request.send(body);
                        const geoJSON = request.responseText;
                        console.log(geoJSON);
                })
                .catch((err) =>{
                    console.log(err);
                });   
        }

        function success(pos) {
          crd = pos.coords;
          console.log(pos.coords);
        }

        function touchAPI1(){
            const urlTemp = "https://g965edebf922493-cojt1.adb.ap-osaka-1.oraclecloudapps.com/ords/admin/tslo/2/";
            const place = document.getElementById("plase").value;
            const URL = urlTemp + place;
            const JN = callAPIOCI(URL);
            
            console.log(JN);
        }
        
        console.log("JavaScriptを実行しています");
    </script>
</html>